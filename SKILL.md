---
name: version-generate
description: Generate structured update.md changelog from latest git tag to HEAD with automatic semantic versioning. Use when user requests changelog generation, release notes, or update documentation.
---

# Changelog Generator

Generate `update.md` from latest git tag to HEAD with automatic semantic versioning.

## Workflow

1. Get latest version tag from git
2. Collect diff between latest tag and HEAD
3. Classify changes and determine version bump
4. Generate structured `update.md`

## Step 1: Version Detection

```bash
git fetch --tags --quiet 2>/dev/null

# Get latest semantic version tag (sorted by version number)
LATEST_TAG=$(git tag -l 'v[0-9]*.[0-9]*.[0-9]*' --sort=-v:refname | head -1)

if [ -z "$LATEST_TAG" ]; then
    LATEST_TAG="v0.0.0"
fi

echo "$LATEST_TAG"
```

## Step 2: Collect Changes

```bash
# Get diff from latest tag to HEAD
git diff $LATEST_TAG..HEAD

# Get commit list since tag
git log $LATEST_TAG..HEAD --oneline

# Get changed files summary
git diff $LATEST_TAG..HEAD --stat
```

## Step 3: Classification Tags

| Tag | Scope | Examples | Version Impact |
|-----|-------|----------|----------------|
| `FEAT` | New functionality | New function, endpoint, component | **MINOR** (0.X.0) |
| `FIX` | Bug correction | Error handling, logic fix, nil check | PATCH (0.0.X) |
| `UPDATE` | Modify existing behavior | Parameter change, algorithm tweak | PATCH |
| `ADD` | New file/resource (not feature) | Config file, asset, dependency | PATCH |
| `REMOVE` | Deletion | Deprecated code, unused file | PATCH |
| `REFACTOR` | Code restructure (no behavior change) | Extract function, rename, reorganize | PATCH |
| `PERF` | Performance improvement | Cache, algorithm optimization | PATCH |
| `STYLE` | Formatting only | Whitespace, linting, import order | — (no bump) |
| `DOC` | Documentation | Comments, README, docstrings | — (no bump) |
| `TEST` | Test-related | New test, test fix, coverage | — (no bump) |
| `CHORE` | Maintenance | CI/CD, tooling, version bump | — (no bump) |
| `SECURITY` | Security patch | Vulnerability fix, auth hardening | PATCH |
| `BREAKING` | Breaking change | API signature change, removal | **MAJOR** (X.0.0) |

## Step 4: Version Bump Rules

```
CURRENT = LATEST_TAG (default: v0.0.0)

IF LATEST_TAG == v0.0.0 (no tags exist):
    NEW = v0.1.0

ELSE:
    MAJOR_TAGS = [BREAKING]
    MINOR_TAGS = [FEAT]
    PATCH_TAGS = [SECURITY, FIX, UPDATE, ADD, REMOVE, REFACTOR, PERF]
    NO_BUMP    = [STYLE, DOC, TEST, CHORE]

    IF any MAJOR_TAGS present:
        MAJOR += 1, MINOR = 0, PATCH = 0
    ELSE IF any MINOR_TAGS present:
        MINOR += 1, PATCH = 0
    ELSE IF any PATCH_TAGS present:
        PATCH += 1
    ELSE:
        NO VERSION CHANGE
```

## Step 5: Output Format

Generate `./update.md`:

```markdown
# Update Log

> Generated: $(date -u '+%Y-%m-%d %H:%M (+00:00)')
> vX.Y.Z → vA.B.C

## Recommended Commit Message

Suggested commit message based on the changes
<details>
<summary>翻譯</summary>
根據變更建議的提交訊息
</details>

***

## Summary

Brief 1-2 sentence overview of changes.
<details>
<summary>翻譯</summary>
變更的簡要說明（1-2句話）
</details>

## Changes

### FEAT
- Description of new feature
  
<details>
<summary>翻譯</summary>

- 新功能描述

</details>

### FIX
- Description of bug fix

<details>
<summary>翻譯</summary>

- 錯誤修正描述

</details>

### UPDATE
- Description of modification

<details>
<summary>翻譯</summary>

- 修改描述

</details>

### REFACTOR
- Description of restructure

<details>
<summary>翻譯</summary>

- 重構描述

</details>

### PERF
- Description of performance improvement

<details>
<summary>翻譯</summary>

- 效能優化描述

</details>

### SECURITY
- Description of security patch

<details>
<summary>翻譯</summary>

- 安全性修補描述

</details>

### DOC
- Description of documentation change

<details>
<summary>翻譯</summary>

- 文件變更描述

</details>

### CHORE
- Description of maintenance task

<details>
<summary>翻譯</summary>

- 維護任務描述

</details>

***

## Files Changed

| File | Status | Tag |
|------|--------|-----|
| `path/to/file.go` | Modified | FEAT |
| `path/to/other.go` | Added | ADD |
| `path/to/removed.go` | Deleted | REMOVE |

***

Generated by [Claude](https://claude.ai)
```

## Classification Rules

1. **Version priority**: `BREAKING` > `FEAT` > `PATCH_TAGS` > `NO_BUMP`
2. **Highest wins**: Single `BREAKING` change → MAJOR bump regardless of other tags
3. **Empty sections**: Omit tags with no changes
4. **First release**: No existing tag → `v0.1.0`
5. **No functional change**: Only `STYLE`/`DOC`/`TEST`/`CHORE` → keep current version
6. **Group related changes**: Combine similar changes under same tag
7. **Scope hierarchy**: `BREAKING` > `SECURITY` > `FEAT` > `FIX` > others > `DOC`
8. **Description format**: Start with verb — Add, Fix, Update, Remove, Refactor
9. **Focus on intent**: Describe what changed and why, not individual files

## Edge Cases

- **New file with feature** → `FEAT` (not `ADD`)
- **Test for new feature** → `TEST` (separate from `FEAT`)
- **Rename + modify** → `REFACTOR` + `UPDATE` (two entries)
- **Delete deprecated + add replacement** → `REMOVE` + `FEAT`
- **.gitignore change** → `CHORE`
- **go.mod/go.sum** → `CHORE` (dependency management)
- **No commits since tag** → Skip generation or note "no changes"

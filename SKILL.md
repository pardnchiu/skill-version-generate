---
name: version-generate
description: Generate structured changelog with recommended new version from latest git tag to HEAD. Use when user requests changelog generation, release notes, or version bump documentation.
---

# Version Generator

Generate `vA.B.C.md` changelog from latest git tag to HEAD, where `vA.B.C` is the **recommended new version**.

## Workflow

1. Get latest version tag from git (`LATEST_TAG`)
2. Collect diff between `LATEST_TAG` and HEAD
3. Classify changes and calculate **new version** (`NEW_VERSION`)
4. Generate `./NEW_VERSION.md`

## Step 1: Version Detection

```bash
git fetch --tags --quiet 2>/dev/null

# Get latest semantic version tag
LATEST_TAG=$(git tag -l 'v[0-9]*.[0-9]*.[0-9]*' --sort=-v:refname | head -1)

if [ -z "$LATEST_TAG" ]; then
    LATEST_TAG="v0.0.0"
fi

echo "Current: $LATEST_TAG"
```

## Step 2: Collect Changes

```bash
# Get diff from latest tag to HEAD
git diff $LATEST_TAG..HEAD

# Get commit list since tag
git log $LATEST_TAG..HEAD --oneline

# Get changed files summary
git diff $LATEST_TAG..HEAD --stat
```

## Step 3: Classification Tags

| Tag | Scope | Examples | Version Impact |
|-----|-------|----------|----------------|
| `FEAT` | New functionality | New function, endpoint, component | **MINOR** (+0.1.0) |
| `FIX` | Bug correction | Error handling, logic fix, nil check | PATCH (+0.0.1) |
| `UPDATE` | Modify existing behavior | Parameter change, algorithm tweak | PATCH |
| `ADD` | New file/resource (not feature) | Config file, asset, dependency | PATCH |
| `REMOVE` | Deletion | Deprecated code, unused file | PATCH |
| `REFACTOR` | Code restructure (no behavior change) | Extract function, rename, reorganize | PATCH |
| `PERF` | Performance improvement | Cache, algorithm optimization | PATCH |
| `STYLE` | Formatting only | Whitespace, linting, import order | — (no bump) |
| `DOC` | Documentation | Comments, README, docstrings | — (no bump) |
| `TEST` | Test-related | New test, test fix, coverage | — (no bump) |
| `CHORE` | Maintenance | CI/CD, tooling, version bump | — (no bump) |
| `SECURITY` | Security patch | Vulnerability fix, auth hardening | PATCH |
| `BREAKING` | Breaking change | API signature change, removal | **MAJOR** (+1.0.0) |

## Step 4: Version Bump Rules

```
LATEST_TAG = vX.Y.Z (default: v0.0.0)

IF LATEST_TAG == v0.0.0 (no tags exist):
    NEW_VERSION = v0.1.0

ELSE:
    MAJOR_TAGS = [BREAKING]
    MINOR_TAGS = [FEAT]
    PATCH_TAGS = [SECURITY, FIX, UPDATE, ADD, REMOVE, REFACTOR, PERF]
    NO_BUMP    = [STYLE, DOC, TEST, CHORE]

    IF any MAJOR_TAGS present:
        NEW_VERSION = v(X+1).0.0
    ELSE IF any MINOR_TAGS present:
        NEW_VERSION = vX.(Y+1).0
    ELSE IF any PATCH_TAGS present:
        NEW_VERSION = vX.Y.(Z+1)
    ELSE:
        NEW_VERSION = LATEST_TAG (no change)
```

**Example:**
- `LATEST_TAG = v1.2.3` + `FEAT` detected → `NEW_VERSION = v1.3.0`
- `LATEST_TAG = v1.2.3` + `FIX` detected → `NEW_VERSION = v1.2.4`
- `LATEST_TAG = v1.2.3` + `BREAKING` detected → `NEW_VERSION = v2.0.0` 

## Step 5: Output Format

Generate `./NEW_VERSION.md` (e.g., `v1.3.0.md`):

```markdown
# vA.B.C

> Previous: vX.Y.Z

## Summary

Brief 1-2 sentence overview of changes.
<details>
<summary>翻譯</summary>
變更的簡要說明（1-2句話）
</details>

## Changes

### FEAT
- Description of new feature
  
<details>
<summary>翻譯</summary>

- 新功能描述

</details>

### FIX
- Description of bug fix

<details>
<summary>翻譯</summary>

- 錯誤修正描述

</details>

### UPDATE
- Description of modification

<details>
<summary>翻譯</summary>

- 修改描述

</details>

### REFACTOR
- Description of restructure

<details>
<summary>翻譯</summary>

- 重構描述

</details>

### PERF
- Description of performance improvement

<details>
<summary>翻譯</summary>

- 效能優化描述

</details>

### SECURITY
- Description of security patch

<details>
<summary>翻譯</summary>

- 安全性修補描述

</details>

### DOC
- Description of documentation change

<details>
<summary>翻譯</summary>

- 文件變更描述

</details>

### CHORE
- Description of maintenance task

<details>
<summary>翻譯</summary>

- 維護任務描述

</details>

***

## Files Changed

| File | Status | Tag |
|------|--------|-----|
| `path/to/file.go` | Modified | FEAT |
| `path/to/other.go` | Added | ADD |
| `path/to/removed.go` | Deleted | REMOVE |

***

Generated by [Claude Code](https://github.com/pardnchiu/skill-version-generate)
```

## Classification Rules

1. **Version priority**: `BREAKING` > `FEAT` > `PATCH_TAGS` > `NO_BUMP`
2. **Highest wins**: Single `BREAKING` change → MAJOR bump regardless of other tags
3. **Empty sections**: Omit tags with no changes
4. **First release**: No existing tag → `v0.1.0`
5. **No functional change**: Only `STYLE`/`DOC`/`TEST`/`CHORE` → keep current version
6. **Group related changes**: Combine similar changes under same tag
7. **Scope hierarchy**: `BREAKING` > `SECURITY` > `FEAT` > `FIX` > others > `DOC`
8. **Description format**: Start with verb — Add, Fix, Update, Remove, Refactor
9. **Focus on intent**: Describe what changed and why, not individual files

## Edge Cases

- **New file with feature** → `FEAT` (not `ADD`)
- **Test for new feature** → `TEST` (separate from `FEAT`)
- **Rename + modify** → `REFACTOR` + `UPDATE` (two entries)
- **Delete deprecated + add replacement** → `REMOVE` + `FEAT`
- **.gitignore change** → `CHORE`
- **go.mod/go.sum** → `CHORE` (dependency management)
- **No commits since tag** → Skip generation or note "no changes"
